# Abstract
描述Spaco网络中的加密传输方法

# Motivation

在当前互联网体系结构下，假设一个数据包从A-->D经过以下节点：

    A-->B--->C--->D

数据在路由器和交换机之间传输的时候，默认是没有加密的。这意味着：

* 任何交换机的镜像端口，都可以查看传输的数据。
* 恶意用户，甚至可以通过交换机的端口进行TCP注入攻击等。比如A用户发送数据给D用户，B节点可以对数据进行篡改，而C和D节点对篡改毫无所知。




# Specification
我们约定在Spaco网络中，数据默认是需要进行加密传输的，以解决：
* 解决数据暴露问题
* 解决数据篡改问题
如同SSR-1里面所述，Spaco网络中每一个节点都有自己的公私钥。节点A和B通信通信过程：

- 节点A生成一个会话密钥用于传递加密数据给节点B
- 节点B有一个公钥P，对应等私钥p，P是ECC sep256k1曲线上的一个点。p是256位整数。 P是基点b，用曲线加法运算提高到p的幂。
- 节点A生成具有私钥q的短暂公钥Q， （节点A随机生成一个20字节的整数，这是私钥q，节点A将基点提高到q的幂，生成公钥Q，这是曲线上的一个点）。
- 节点A发送P * q（曲线P上的点，B为公钥，提升为q的幂）
- 节点A发送P到节点B
- 节点B接收P并计算P * q，节点A可以计算相等的p * Q。 这是共享密钥，它被哈希生成会话密钥。
- P = b*q,于是 P*q 等于 (b*p)*q.  P*q = (b*p)*q = (b*q)*p = Q*p, since Q=b*q. 节点A 知道 q,Q 和 P, 节点 B 知道 p,P 和 Q. 于是节点 A 和 B 都可以计算 P*q 和 Q*p 并使用它作为秘钥 . 但是，第三方不知道节点A的私钥q 和节点B的私钥p，所以第三方无法计算出“秘钥” 不能够读取加密的内容。
- 节点B确认会话密钥的更新接收，一旦从B收到确认，节点A开始在新的会话密钥下进行数据发送。
- 节点A通过使用会话密钥的ChaCha20作为非对称加密密钥将消息加密到节点B。

备选算法可以使用：
* chacha20
* AES

默认中间的A，B，C，D节点间的链路加密的；我们也建议进行端到端的加密。

# Backward compatibility

# Implementation


 

